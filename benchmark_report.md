# 八字命理大模型评测基准：实验报告

> **生成日期**：2026-01-27  
> **数据集**：BaziQA (2021–2025)，共 200 道选择题（内部数据集 id 与文件名仍沿用 `contest8_*`，便于复现与兼容现有脚本）  
> **评测模型**：DeepSeek-R1、DeepSeek-Chat-V3、GPT-5.1-Chat、Gemini-2.5-Flash、Gemini-3-Pro

---

## 摘要

本报告对五款主流大语言模型在八字命理推断任务上的表现进行了系统性评测，并提出了一种**三阶段结构化推理协议**（Structured Reasoning Protocol）用于提升命理推断准确率。主要发现：

1. **多轮对话（Multi-turn）主对比中，DeepSeek-Chat-V3 综合最好**：在 2021–2025 五年（每年 40 题）上，宏平均准确率为 **36.7%**，年际标准差 **2.8%**。
2. **结构化推理的收益是“小幅正向但不稳定”**：跨年宏平均上，Structured 相对 Multi-turn 为 **+1.3pp（DeepSeek-Chat-V3）**与 **+0.9pp（DeepSeek-R1）**（见第 4.3 节）。但逐年配对（McNemar）显示收益并不稳定，结论需避免“只看某一年”的外推（见第 4.4 节）。
3. **所有主对比模型显著优于随机猜测（25%）**：基于“跨多次运行汇总”的二项检验，p 值范围为 $[1.7\times 10^{-16},\ 8.9\times 10^{-8}]$（见第 6 节；注意多次运行复用同一套题目，统计独立性假设并不严格）

---

## 1. 实验设置

### 1.1 数据集

| 属性     | 说明                                                  |
| -------- | ----------------------------------------------------- |
| 数据来源 | BaziQA（由 Contest8 八字命理竞赛真题整理，2021–2025） |
| 每年规模 | 8 位命主 × 5 道选择题 = 40 题                         |
| 总计     | 200 道选择题（5 年）                                  |
| 题目类型 | 四选一（A/B/C/D）                                     |
| 随机基线 | 25%                                                   |

**数据集设计特点**：

- **多维覆盖**：涵盖婚姻感情、事业职业、健康身体、财运财富、学业学历、家庭亲人、性格特质、流年运势八大命理领域
- **难度梯度**：每位命主的5道题按顺序涵盖从基础判断到复杂推演
- **真实场景**：所有题目均来自专业命理竞赛，而非人工构造

### 1.2 评测方法

#### 1.2.1 多轮对话（Multi-turn Conversation）

标准的 few-shot 提示方式，先提供完整的八字排盘信息（包括天干地支、大运流年、十神关系等），然后逐题问答。模型自由发挥推理策略。

#### 1.2.2 三阶段结构化推理协议（Structured Reasoning Protocol）

本研究提出的核心方法创新。强制模型按照以下三阶段框架进行推理：

**第一阶段：量化扫描（Quantitative Scan）**

- 清点原局五行数量及强弱
- 识别特殊格局：假印、入墓、空亡
- 确定日主强弱和用神喜忌

**第二阶段：冲突定级（Severity Grading）**

- **一级（轻微）**：刑冲破害但有通关或合化解救
- **二级（中度）**：本气受损超过50%，但仍有余气或贵人相助
- **三级（严重/致命）**：天干地支双冲、忌神成局无解

**第三阶段：应象映射（Mapping to Life Events）**

- 六亲定位：确定题目涉及的六亲十神
- 宫位判定：年月日时分别对应祖辈、父母、自我、子女
- 逻辑推演：将命理符号映射到具体生活事件

**设计理念**：传统命理师的推断过程是隐式的，本协议将其显式化、结构化，减少模型的"跳跃式思维"和遗漏关键步骤的可能。

### 1.3 模型配置

| 模型简称         | 完整标识                       | 类型     | 特点         |
| ---------------- | ------------------------------ | -------- | ------------ |
| deepseek-r1      | deepseek/deepseek-r1-0528      | 推理模型 | 擅长长链推理 |
| deepseek-chat-v3 | deepseek/deepseek-chat-v3-0324 | 对话模型 | 通用能力强   |
| gpt-5.1-chat     | openai/gpt-5.1-chat            | 对话模型 | 稳定性高     |
| gemini-2.5-flash | google/gemini-2.5-flash        | 对话模型 | 速度快       |
| gemini-3-pro     | google/gemini-3-pro-preview    | 推理模型 | 预览版本     |

### 1.4 回答哪些问题？

**RQs（本报告对应的结论位置）**：
1. **RQ1：主对比（Multi-turn）下谁更强？差距有多大？** → 第 2 章（宏平均、逐年趋势）
2. **RQ2：协议/提示（Structured）是否带来稳定收益？收益来自哪里？** → 第 4 章（跨年宏平均 + 逐题配对 + domain Δ）
3. **RQ3：结论是否对年份/题型稳健？**（避免“只看某一年”的过拟合结论）→ 第 4.4–4.6、5.1–5.2 章
4. **RQ4：难点在哪里？是否存在系统性“硬例题/困难特征”？** → 第 6.5–6.6 章
5. **RQ5：成本—收益如何权衡？**（tokens/题 vs accuracy）→ 第 6.7 章

### 1.3 Leaderboard 定义与统计口径（Benchmark protocol）

通用 benchmark 论文通常需要明确“排行榜是怎么定义出来的”，否则不同团队会用不同口径导致不可比。本文采用以下口径（对应脚本输出字段）。

**(1) 主排行榜任务（默认）**：BaziQA 2021–2025，Multi-turn，primary runs。
- **入榜条件**：同一模型在 2021–2025 均有 primary runs（每年 40 题，且 run 文件满足编号规则）。
- **聚合方式**：先按“年”对多次运行取均值，再对年份取均值（macro-average）。
- **不确定性**：对 5 个年份均值做 t 区间 95% CI（计算方法见 1.4）。

**(2) 方法对比任务（Structured vs Multi-turn）**：逐题配对（避免把重复运行当独立样本）。
- **majority-vote 配对（默认）**：每题对 5 runs 多数票得到代表性正确/错误，再逐题做 McNemar（exact McNemar two-sided）。
- **all-run-pairs（补充 / 敏感性分析）**：不假设 structured 与 multi-turn 的 run 编号可对齐，而是在每题上对两边 runs 做 5×5 笛卡尔配对，用于展示“run 组合变化带来的点估计波动”。

**(3) 覆盖/运行次数说明（避免“选择性汇报”）**：

| model | method | years | n_runs |
|------|--------|------:|------:|
| deepseek-chat-v3 | multi-turn-conversation | 2021–2025 | 25 |
| deepseek-chat-v3 | structured-reasoning | 2021–2025 | 25 |
| deepseek-r1 | multi-turn-conversation | 2021–2025 | 25 |
| deepseek-r1 | structured-reasoning | 2021–2025 | 25 |
| gpt-5.1-chat | multi-turn-conversation | 2021–2025 | 25 |
| gemini-2.5-flash | multi-turn-conversation | 2021–2025 | 25 |
| gemini-3-pro | multi-turn-conversation | 2021–2025 | 25 |

## 2. 主要结论

### 2.1 综合排名（宏平均准确率）

为保证公平对比，本文“综合排名”仅统计 **BaziQA 2021–2025（每年 40 题）且覆盖完整** 的模型，并以 **Multi-turn Conversation** 为主对比方法。宏平均定义为：对每一年取“该年多次运行的平均准确率”，再对年份做均值（macro-average）。

**表 1：主对比模型的宏平均准确率（Multi-turn, 2021–2025）**

说明：宏平均以“每年 40 题、5 次运行均值”为单位做跨年均值；95% CI 为跨年 t 区间（n_years=5）。

| 排名 | 模型 | 宏平均准确率 | 95% CI（跨年） | n_years | n_runs_total | 评价 |
|:----:|------|:------------:|:--------------:|:------:|:-----------:|------|
| 🥇 1 | **DeepSeek-Chat-V3** | **36.7%** | **[33.2%, 40.2%]** | 5 | 25 | 综合最好 |
| 🥈 2 | DeepSeek-R1 | 34.1% | [29.6%, 38.6%] | 5 | 25 | 年际波动更大 |
| 🥉 3 | GPT-5.1-Chat | 32.5% | [29.0%, 36.0%] | 5 | 25 | 稳定性较好 |
| 4 | Gemini-2.5-Flash | 32.4% | [29.7%, 35.1%] | 5 | 25 | 年际最稳 |
| 5 | Gemini-3-Pro | 32.1% | [26.6%, 37.6%] | 5 | 25 | 年际波动较大 |

**图 1：宏平均准确率（Multi-turn，主对比）**

![宏平均准确率（Multi-turn，主对比）](assets/plots/contest8_macroavg_accuracy_multiturn.png)

**深度分析**：

对“综合排名”的解释建议（面向论文写作）：
1. **对话模型的“隐式规则匹配”优势**：BaziQA 的题干风格与常见中文命理表达高度一致，DeepSeek-Chat-V3 可能更擅长直接匹配题型模式，从而在 Multi-turn 下取得更高的整体均值。
2. **推理模型的收益更依赖提示协议**：DeepSeek-R1 在部分年份/题型上表现突出，但跨年波动更大，提示其优势可能需要更强的结构化约束或更一致的上下文组织。

为什么 Gemini-2.5-Flash 年际最稳？
- 年际标准差为 2.2%（五个主对比模型最低），说明其跨年均值波动更小
- 可能原因：提示遵循更一致、输出更“保守”，从而降低年际方差；但也可能意味着在部分年份难题上缺少“冲高”的能力

### 2.2 逐年表现趋势

**图 1b：逐年准确率曲线（Multi-turn，主对比模型）**

![逐年准确率曲线](assets/plots/contest8_yearwise_accuracy.png)

| 年份 | 第一名 | 第二名 | 第三名 | 第四名 | 第五名 |
|:----:|--------|--------|--------|--------|--------|
| 2021 | DeepSeek-Chat-V3 (37.0%) | GPT-5.1 (35.0%) | Gemini-3-Pro (33.5%) | DeepSeek-R1 (31.5%) | Gemini-2.5 (29.0%) |
| 2022 | DeepSeek-Chat-V3 (41.0%) | DeepSeek-R1 (40.0%) | Gemini-2.5 (32.5%) | GPT-5.1 (30.5%) | Gemini-3-Pro (30.0%) |
| 2023 | GPT-5.1 (36.0%) | DeepSeek-Chat-V3 (33.5%) | Gemini-2.5 (33.0%) | DeepSeek-R1 (32.5%) | Gemini-3-Pro (26.5%) |
| 2024 | Gemini-3-Pro (38.5%) | DeepSeek-Chat-V3 / DeepSeek-R1 并列 (35.0%) | Gemini-2.5 (32.5%) | GPT-5.1 (31.5%) | — |
| 2025 | DeepSeek-Chat-V3 (37.0%) | Gemini-2.5 (35.0%) | Gemini-3-Pro (32.0%) | DeepSeek-R1 (31.5%) | GPT-5.1 (29.5%) |


**趋势解读**：

1. **跨年波动存在但幅度有限**：以五个主对比模型的"逐年均值"来看，整体落在约 26%–41% 区间，且各年之间差异不完全一致，提示 BaziQA 同时包含"题目难度差异"和"模型-题型匹配差异"。

2. **年份难度存在波动（按均值）**：对主对比模型求平均后，2022 的平均准确率最高（34.8%），2023 最低（32.3%）。该结论可用作"年份难度波动"的定量证据（见第 5.1 节）。

3. **说明**：上表为“对同一年份的多次运行取均值”的 year-level mean，因此与“单次运行最好成绩”不同。

---

## 3. 命理领域分析（基于题干启发式标签）

数据文件 `data/contest8_*.json` 虽包含 `categories` 字段，但当前并未提供可直接复用的逐题领域标注。为得到可复现的“领域级统计”，本文采用**题干关键词规则**对每题赋予一个领域标签，并将结果写入逐题明细 `docs/assets/per_question.csv` 的 `domain` 列。

- 标签生成逻辑：见 `scripts/analyze_results.py` 中的 `infer_domain_from_question()`
- 领域集合：`感情 / 事业 / 健康 / 财富 / 学业 / 六亲 / 性格 / 流年运势 / 其他`
**图 2：题目领域分布（200 道题，2021–2025）**

![题目领域分布](assets/plots/contest8_domain_distribution.png)

**解读**：流年运势（66 题，33%）和感情（37 题，18.5%）占据了超过半数题目，而健康（5 题）与财富（6 题）样本较少，后续 domain 级别的统计结论需注意样本量差异。

---

## 4. 三阶段结构化推理协议的效果验证

### 4.1 方法核心思想

传统的 Multi-turn 提示中，模型可以自由选择推理路径：有时会跳过关键中间判断（例如先定十神/六亲、再谈应期），也可能在信息量很大时出现“遗漏关键约束/自相矛盾”。三阶段结构化推理协议的目标不是引入外部知识，而是把命理师常用的推断流程显式化为一个可复现的提示框架，以降低遗漏与路径漂移风险。

```
┌─────────────────────────────────────────────────────────────────┐
│  第一阶段：量化扫描 (Quantitative Scan)                           │
│  ├─ 清点原局天干地支的五行分布                                     │
│  ├─ 判定日主强弱（旺/弱/从/化）                                    │
│  └─ 识别特殊格局：假印、入墓、空亡、羊刃等                          │
├─────────────────────────────────────────────────────────────────┤
│  第二阶段：冲突定级 (Severity Grading)                            │
│  ├─ 一级（轻微）：有冲克但存在通关或合化解救                        │
│  ├─ 二级（中度）：本气受损>50%，但有余气或贵人                      │
│  └─ 三级（严重）：天干地支双冲、忌神成局无解                        │
├─────────────────────────────────────────────────────────────────┤
│  第三阶段：应象映射 (Mapping to Life Events)                      │
│  ├─ 六亲定位：题目涉及哪个十神（财官印食伤比劫）                    │
│  ├─ 宫位定位：年月日时分别对应的人生领域                           │
│  └─ 事象推演：将命理符号映射为具体答案                             │
└─────────────────────────────────────────────────────────────────┘
```

### 4.2 方法与对照口径

本节评估三阶段结构化推理协议（Structured Reasoning Protocol）相对 Multi-turn 的效果，并明确避免“只看某一年”的结论偏差。

对照口径（均来自 primary runs）：

1) **majority-vote（n=40/年）**：对每题在 5 runs 内做多数票得到代表性正确/错误，再逐题配对（本文默认主结论使用此口径）。
2) **all-run-pairs（n=40×5×5/年）**：不假设 run 编号对齐，对每题做 structured 与 multi-turn 的 5×5 run 笛卡尔配对，作为敏感性分析（不应把这些 pair 当作独立样本来做“更显著”的推断）。

配对汇总数据：逐题多数票配对与 all-run-pairs 敏感性分析均由 `scripts/analyze_results.py` 自动生成（详见 1.4）。

### 4.3 跨年总体：点估计接近 0（且不稳定）

按跨年宏平均（把每年的 run-mean 视为一个样本，n_years=5）汇总：

| 模型 | Multi-turn 宏平均 | Structured 宏平均 | 结论（点估计） |
|------|:-----------------:|:-----------------:|----------------|
| DeepSeek-Chat-V3 | 36.7% | **38.0%** | Structured 略高（+1.3pp） |
| DeepSeek-R1 | 34.1% | **35.0%** | Structured 略高（+0.9pp） |

**图 3：Structured vs Multi-turn 配对视图**

![Structured vs Multi-turn 配对视图](assets/plots/contest8_structured_vs_multiturn_paired.png)

**解读**（左图）：宏平均显示 Structured 略高于 Multi-turn，但误差条有明显重叠；（右图）：逐年配对 Δ 显示效果不稳定——DeepSeek-R1 在 2022/2024 有 +10pp 增益，但在 2023 反而 -10pp。这说明 Structured 协议的收益具有**年份依赖性**，不能简单外推为"总是更好"。



### 4.4 逐年配对结果：效果具有明显年份依赖

下表为 **majority-vote（n=40/年）** 的逐年配对结果（Structured − Multi-turn；p-value 为 exact McNemar two-sided，由 `scripts/analyze_results.py` 自动计算生成）：

DeepSeek-Chat-V3：

| 年份 | Δaccuracy | b（MT错/Struct对） | c（MT对/Struct错） | p-value |
|:---:|:--------:|:------------------:|:------------------:|:------:|
| 2021 | +2.5pp | 5 | 4 | 1.000 |
| 2022 | +2.5pp | 6 | 5 | 1.000 |
| 2023 | -5.0pp | 6 | 8 | 0.791 |
| 2024 | +0.0pp | 4 | 4 | 1.000 |
| 2025 | +2.5pp | 6 | 5 | 1.000 |

DeepSeek-R1：

| 年份 | Δaccuracy | b（MT错/Struct对） | c（MT对/Struct错） | p-value |
|:---:|:--------:|:------------------:|:------------------:|:------:|
| 2021 | -2.5pp | 3 | 4 | 1.000 |
| 2022 | +10.0pp | 8 | 4 | 0.388 |
| 2023 | -10.0pp | 3 | 7 | 0.344 |
| 2024 | +10.0pp | 8 | 4 | 0.388 |
| 2025 | +5.0pp | 6 | 4 | 0.754 |


### 4.4.1 敏感性分析：run 配对选择会让点估计波动多大？

由于 multi-turn 与 structured 的“run 编号”不一定可对齐，我们补充 all-run-pairs（每题 5×5 笛卡尔配对）的摘要统计。下表给出每年 25 个 run-pair 的 $\Delta$（Structured − Multi-turn）分布（单位：pp；`frac_pos` 为 25 个 run-pair 中 $\Delta>0$ 的比例）。

| model | year | n_run_pairs | mean_pp | median_pp | p25_pp | p75_pp | min_pp | max_pp | frac_pos |
|---|---|---|---|---|---|---|---|---|---|
| deepseek-chat-v3 | 2021 | 25 | +2.0 | +2.5 | -2.5 | +7.5 | -12.5 | +15.0 | 60% |
| deepseek-chat-v3 | 2022 | 25 | -0.0 | +0.0 | -5.0 | +5.0 | -15.0 | +10.0 | 48% |
| deepseek-chat-v3 | 2023 | 25 | -0.0 | +2.5 | -2.5 | +2.5 | -12.5 | +5.0 | 56% |
| deepseek-chat-v3 | 2024 | 25 | -0.5 | +0.0 | -2.5 | +5.0 | -12.5 | +12.5 | 36% |
| deepseek-chat-v3 | 2025 | 25 | +5.0 | +2.5 | +0.0 | +7.5 | -2.5 | +20.0 | 72% |
| deepseek-r1 | 2021 | 25 | +3.5 | +2.5 | +0.0 | +7.5 | -5.0 | +17.5 | 52% |
| deepseek-r1 | 2022 | 25 | +1.5 | +2.5 | -2.5 | +10.0 | -15.0 | +15.0 | 52% |
| deepseek-r1 | 2023 | 25 | -2.5 | -2.5 | -7.5 | +2.5 | -15.0 | +10.0 | 28% |
| deepseek-r1 | 2024 | 25 | -2.0 | -2.5 | -5.0 | +5.0 | -17.5 | +12.5 | 36% |
| deepseek-r1 | 2025 | 25 | +4.0 | +5.0 | +0.0 | +7.5 | -12.5 | +15.0 | 68% |

**解读**：如果结论在 majority-vote 下为正，但在 all-run-pairs 中 `frac_pos` 接近 50% 且区间跨过 0，说明“run 内随机性/采样差异”足以让点估计翻转；此时应避免把单次运行对比当作稳健结论。

![Structured 相对 Multi-turn 的逐年增益（逐题配对）](assets/plots/contest8_paired_delta_by_year.png)

### 4.5 加入 domain 分析：结构化协议的收益存在领域异质性

为了避免把“重复运行”当作独立样本，本节的 domain 分解使用 **逐题多数票**口径：

1) 对每题在 5 runs 内多数票得到每方法的代表性正确/错误（`maj_correct`）。
2) 在同一题上配对 Structured 与 Multi-turn，计算每个 domain 的 $\Delta=\mathrm{Acc}_{\mathrm{struct}}-\mathrm{Acc}_{\mathrm{mt}}$。
3) 为了给出不确定性，我们对“题目集合”做 paired bootstrap（重采样题目，n_boot=2000），得到 $\Delta$ 的 95% percentile CI；当某 domain 的可配对题目数过少（<5）时不报告 CI。

需要强调：domain 为题干关键词启发式标签，非金标准，仅用于探索性证据；95% CI 来自 paired bootstrap（重采样题目）。

**跨年汇总（2021–2025 合并，year=all；Δ为 pp）**：

DeepSeek-Chat-V3：

| domain | n_items | Δ(pp) | 95% CI(pp) |
|--------|:------:|:-----:|:----------:|
| 事业 | 18 | +0.0 | [-22.2, +22.2] |
| 健康 | 5 | +40.0 | [+0.0, +80.0] |
| 六亲 | 20 | +5.0 | [-25.0, +35.0] |
| 其他 | 28 | -3.6 | [-21.4, +14.3] |
| 学业 | 9 | +44.4 | [+11.1, +77.8] |
| 性格 | 11 | +0.0 | [-27.3, +27.3] |
| 感情 | 37 | -10.8 | [-27.0, +5.4] |
| 流年运势 | 66 | +0.0 | [-10.6, +12.1] |
| 财富 | 6 | -16.7 | [-50.0, +0.0] |

DeepSeek-R1：

| domain | n_items | Δ(pp) | 95% CI(pp) |
|--------|:------:|:-----:|:----------:|
| 事业 | 18 | +5.6 | [-11.1, +22.2] |
| 健康 | 5 | +20.0 | [-60.0, +100.0] |
| 六亲 | 20 | -20.0 | [-40.0, -5.0] |
| 其他 | 28 | +0.0 | [-17.9, +14.3] |
| 学业 | 9 | +22.2 | [-22.2, +55.6] |
| 性格 | 11 | +9.1 | [-18.2, +36.4] |
| 感情 | 37 | +0.0 | [-18.9, +16.2] |
| 流年运势 | 66 | +4.5 | [-6.1, +15.2] |
| 财富 | 6 | +16.7 | [-33.3, +66.7] |

### 4.6 本节结论（更稳健的论文表述）

1. Structured 在少数年份/领域上出现正向效果；跨年汇总显示两模型均为小幅正向（DeepSeek-Chat-V3 +1.3pp、DeepSeek-R1 +0.9pp），但逐年/逐域表现不稳定。
2. 更合理的定位是：Structured 是一种**可控的提示协议**，可能需要按年份/领域校准模板，或与更强的“中间结构化记录”提示配合。
3. 更细的“逐题翻正/翻错”证据与配对检验细节在第 6.3 节（并提供可复现样例文件）。

---

## 5. 题目难度与错误模式分析

### 5.1 年份难度波动（主对比模型均值）

以五个主对比模型（Multi-turn，40 题/年）的"逐年均值"再取平均，得到年份难度的粗粒度估计：

| 年份 | 五模型平均准确率 |
|:----:|:--------------:|
| 2021 | 33.2% |
| 2022 | 34.8% |
| 2023 | 32.3% |
| 2024 | 34.5% |
| 2025 | 33.0% |

这说明：BaziQA 确实存在年份间波动，但幅度在几个百分点量级；后续可以考虑引入 IRT/难度标定来“去年份偏差”。

### 5.2 命理领域（domain）差异

本文的数据源未提供逐题的“领域/题型”金标准标签，因此我们在 `scripts/analyze_results.py` 中使用题干关键词规则生成了可复现但粗粒度的 `domain`（见 `docs/assets/per_question.csv`，并在 `docs/assets/contest8_domain_grouped.csv` 中做了聚合）。

需要强调：该标签仅用于**探索性分析**（会存在误分/漏分），不应被当作严格的题型注释。

**Multi-turn（主对比、2021–2025 汇总）各领域准确率**（按领域汇总正确/总数得到的准确率）：

| 领域 | DeepSeek-Chat-V3 | DeepSeek-R1 | GPT-5.1-Chat | Gemini-2.5-Flash | Gemini-3-Pro |
|------|:---------------:|:-----------:|:------------:|:----------------:|:------------:|
| 事业 | 27.8% | 23.3% | **31.1%** | 25.6% | 23.3% |
| 健康 | 32.0% | 48.0% | 20.0% | 36.0% | **60.0%** |
| 六亲 | **53.0%** | 42.0% | 38.0% | 45.0% | 40.0% |
| 其他 | 29.3% | **37.1%** | 22.1% | 22.9% | 24.3% |
| 学业 | 22.2% | 28.9% | 26.7% | 26.7% | **31.1%** |
| 性格 | **52.7%** | 45.5% | 36.4% | 34.5% | 50.9% |
| 感情 | **35.1%** | 27.0% | 25.9% | 28.6% | 31.9% |
| 流年运势 | 37.9% | 36.4% | **40.3%** | 36.7% | 30.6% |
| 财富 | **36.7%** | 20.0% | 33.3% | 33.3% | 30.0% |

**观察**（仅作定性总结）：

- **健康领域**：Gemini-3-Pro 表现突出（60.0%），显著高于其他模型，DeepSeek-R1 也表现较好（48.0%）
- "六亲/性格"在 DeepSeek-Chat-V3 上显著更高，可能反映其更擅长从题干描述中抽取稳定人格/家庭关系线索
- "流年运势"整体更接近中等水平，且在 GPT-5.1-Chat 上更高（40.3%），提示其对"年份/转折点"类题干可能更稳健
- Gemini-3-Pro 在"健康"和"性格"上表现出色，但在"流年运势"（30.6%）上明显低于其他主流模型，这可能解释了其年际波动较大的特点

**2025 年：Structured vs Multi-turn 的领域分解**（主对比；注意：2025 并非所有领域都有题目出现）：

DeepSeek-Chat-V3：

| 领域 | Multi-turn | Structured |
|------|:---------:|:----------:|
| 感情 | 31.4% | 34.3% |
| 事业 | 32.5% | 30.0% |
| 学业 | 50.0% | **80.0%** |
| 六亲 | 60.0% | 56.7% |
| 性格 | 90.0% | **100.0%** |
| 流年运势 | 26.0% | 34.0% |
| 其他 | 20.0% | 32.0% |

DeepSeek-R1：

| 领域 | Multi-turn | Structured |
|------|:---------:|:----------:|
| 感情 | 17.1% | **31.4%** |
| 事业 | 25.0% | **40.0%** |
| 学业 | **70.0%** | 60.0% |
| 六亲 | **40.0%** | 30.0% |
| 性格 | **100.0%** | 80.0% |
| 流年运势 | 26.0% | **36.0%** |
| 其他 | **20.0%** | 12.0% |

从 2025 的分解可以看到：Structured 的收益可能集中在“需要显式整理信息/映射年份”的题干类型（例如流年运势），但也可能在某些域出现回落；这也呼应了第 4.5 节“当前样本规模不足以得出全局必胜”的结论。

---

## 6. 统计分析与显著性检验

### 6.1 与随机基线的比较

所有模型是否显著优于 25% 的随机猜测？

| 模型 | 正确/总计（跨运行汇总） | 准确率 | 95% Wilson CI | p-value (vs 25%) |
|------|:----------------------:|:------:|:-------------:|:----------------:|
| DeepSeek-Chat-V3 | 367/1000 | 36.7% | [33.8%, 39.7%] | 1.7×10⁻¹⁶ |
| DeepSeek-R1 | 341/1000 | 34.1% | [31.2%, 37.1%] | 1.4×10⁻¹⁰ |
| GPT-5.1-Chat | 325/1000 | 32.5% | [29.7%, 35.5%] | 6.1×10⁻⁸ |
| Gemini-2.5-Flash | 324/1000 | 32.4% | [29.6%, 35.4%] | 8.9×10⁻⁸ |
| Gemini-3-Pro | 321/1000 | 32.1% | [29.3%, 35.1%] | 2.7×10⁻⁷ |

**说明**：这里的“总计”对同一套题目的多次运行进行了汇总，因此严格意义上并非独立同分布样本；表格主要用于展示“显著高于随机”的量级，而非用于严谨的模型间差异推断。

**95% CI 验证（已做）**：本文对“跨运行汇总”的准确率使用 Wilson score interval 计算 95% CI（见上表），相较于正态近似在中等样本下更稳健。

**结论**：所有模型均**显著优于随机猜测**（p < 0.05），其中 DeepSeek 系列达到极显著水平（p < 0.001）。这证明 LLM 确实习得了八字命理的某些推断能力，而非单纯的随机猜测。

### 6.2 模型间差异的显著性

以 Multi-turn 下 DeepSeek-Chat-V3（367/1000）与 DeepSeek-R1（341/1000）的跨运行汇总为例，Fisher 精确检验得到 p ≈ 0.242（卡方检验 p ≈ 0.224）。

**结论**：在当前样本规模与“跨运行汇总”的统计假设下，模型间差异未达到显著水平；若要做更严格的模型对比，建议：
1. 固定每个模型每年 1 次（或同等次数）运行；
2. 以“逐题配对”的方式进行统计检验（例如 McNemar 检验），避免重复运行导致的相关性。

### 6.3 逐题配对检验：Structured vs Multi-turn 到底修复了什么？

仅看 run-level 均值/方差，容易给人“提升是否来自少数题/是否可复现”的疑问。为此我们补充了**逐题配对**对比：majority-vote 给出主结论，all-run-pairs 给出敏感性分析（两者均由 `scripts/analyze_results.py` 自动生成；复现方式见 1.4）。

我们以 **majority-vote（题目级，n=40/年）** 作为默认配对口径：它不依赖“run 编号对齐”，因此适用于当前实验组织方式。

**2025 年（majority-vote；exact McNemar, two-sided）**：

| 模型 | n_pairs | Structured − Multi-turn | b（MT错/Struct对） | c（MT对/Struct错） | p-value |
|------|:------:|:-----------------------:|:------------------:|:------------------:|:------:|
| DeepSeek-Chat-V3 | 40 | +2.5pp | 6 | 5 | 1.000 |
| DeepSeek-R1 | 40 | +5.0pp | 6 | 4 | 0.754 |

同时，我们用 **all-run-pairs（每题 5×5）** 做敏感性分析（见第 4.4.1 节）：它回答“run 组合变化会不会让点估计翻转”，但不应被当作独立样本来获得更小 p 值。

**解读**：两种配对口径下点估计均为正，但由于题目数量与重复次数较小，尚不足以给出 $p<0.05$ 的强结论。与“跨运行汇总”的非独立性相比，逐题配对至少能回答“是否存在系统性的翻正（b>c）”。

![Structured 相对 Multi-turn 的逐年增益（逐题配对）](assets/plots/contest8_paired_delta_by_year.png)

我们还导出了 2025 的逐题翻正/翻错样例（见 `docs/assets/contest8_flip_examples_2025.csv`），可用于人工复核“Structured 到底改善了哪类题”。

为避免“挑题举例”给人以统计意义的错觉，本文不在主结果章节展示具体题目文本；如需做**定性误差分析**与人工复核，可参考附录 D（样例来自 `docs/assets/contest8_flip_samples_2025_majority.csv`，为确定性抽取）。

**图 4：2025 年不同命主（命盘）上的 Multi-turn 难度热力图（多数票口径）**

![2025 命主难度热力图（Multi-turn，多数票）](assets/plots/contest8_2025_person_accuracy_heatmap_multiturn_majority.png)

**图 5：2025 年 Structured 相对 Multi-turn 的“命主级”增益（多数票口径）**

![2025 命主级增益热力图（Structured − Multi-turn，多数票）](assets/plots/contest8_2025_person_delta_heatmap_struct_minus_multiturn_majority.png)

**解读（为什么这比均值表更“论文”）**：从命主级热力图可以看到提升并非均匀分布：
- Structured 对部分命主带来可见增益（例如两个模型在 `beijing_male_19700722_P008` 上均为 +0.20）。
- 也存在“反向受损”的命主（例如 DeepSeek-Chat-V3 在 `hongkong_female_19870705_P002` 与 `taiwan_female_19880215_P007` 上为 -0.20）。
- 存在极难命主（例如 `miyazaki_male_19830421_P003` 在 Multi-turn 下多模型接近 0），提示后续更值得做的是针对这类命盘的协议/信息整理增强，而不是只追求全局均值。

（数据源：`docs/assets/contest8_2025_person_accuracy_majority.csv`、`docs/assets/contest8_2025_person_delta_struct_minus_multiturn_majority.csv`。）

### 6.4 宏平均准确率的 95% CI（跨年份）

为补充“综合排名”的不确定性，我们将每个模型在 5 个年份上的 **year-level mean accuracy** 视为 5 个观测值，并对其均值计算 t 区间（n=5，95% CI）：

| 模型 | 宏平均（Multi-turn） | 95% CI（跨年份） |
|------|:--------------------:|:----------------:|
| DeepSeek-Chat-V3 | 36.7% | [33.2%, 40.2%] |
| DeepSeek-R1 | 34.1% | [29.6%, 38.6%] |
| GPT-5.1-Chat | 32.5% | [29.0%, 36.0%] |
| Gemini-2.5-Flash | 32.4% | [29.7%, 35.1%] |

**解读**：由于 n=5 较小且区间重叠明显，宏平均排名应被视为“当前数据下的点估计”，而非强统计显著的优劣结论。

### 6.5 题目难度：存在“全模型全错”的硬例题

仅看平均准确率很难回答"模型到底卡在哪"。为给出一个**可复核**的"题目难度"定义，我们在 Multi-turn（primary runs）下，用五个主对比模型（DeepSeek-Chat-V3、DeepSeek-R1、GPT-5.1-Chat、Gemini-2.5-Flash、Gemini-3-Pro）的逐题结果定义 item difficulty：

- 对每个题目 item（`year, person_id, idx`），先对每个模型在该题上的多次运行取平均正确率 $\mathrm{acc}_{m}(i)$；
- 再对五个模型取均值：$\mathrm{difficulty}(i)=\frac{1}{5}\sum_{m}\mathrm{acc}_{m}(i)$。

我们将 **hard items（硬例题）** 定义为：$\mathrm{difficulty}(i)=0$（五个模型在该题上均为 0，即每个模型在其全部 primary runs 上都未答对过该题）。

**表 6.5.1：硬例题数量总览（Multi-turn；五模型均值 difficulty）**

| 指标 | 数值 |
|---|---:|
| n_items_total | 200 |
| n_hard_items | 19 |
| hard_items_pct | 9.5% |

**表 6.5.2：硬例题按年份分布**

| year | n_hard |
|---|---:|
| 2021 | 3 |
| 2022 | 2 |
| 2023 | 5 |
| 2024 | 1 |
| 2025 | 8 |

**表 6.5.3：硬例题按领域（domain）分布**

| domain | n_hard |
|---|---:|
| 流年运势 | 6 |
| 其他 | 4 |
| 事业 | 3 |
| 感情 | 2 |
| 六亲 | 1 |
| 学业 | 1 |
| 性格 | 1 |
| 财富 | 1 |

**解读**：硬例题占比达到 9.5%，且在 2025 与"流年运势/其他"类题干中更集中。这说明数据集里确实存在一批"当前主流提示方式难以攻克"的题目，而不是单纯噪声波动。

![题目难度分布（五模型均值）](assets/plots/contest8_item_difficulty_hist.png)



### 6.6 题干特征与错误模式（启发式相关性）

我们从题干中抽取了可复现的轻量特征（是否出现健康/婚恋/事业等关键词、是否包含显式年份数字等），并报告“有该特征 vs 无该特征”的平均准确率差（见 `docs/assets/contest8_feature_effects.csv`；逐题明细在 `docs/assets/contest8_error_taxonomy.csv`）。

**Multi-turn 下最稳定的“困难特征”**（相关性，不代表因果）：

- **健康类题干**在 DeepSeek-Chat-V3 与 GPT-5.1-Chat 上明显更难（约 -11pp 量级）。
- **婚恋关键词题干**在 Gemini-2.5-Flash 上更难（约 -10pp 量级），在 DeepSeek-R1 上也有下降。
- **事业/职业关键词题干**对 DeepSeek-R1 不友好（约 -9.7pp 量级）。

注意：这些结论依赖启发式特征，且不同特征覆盖的题目数不同（例如健康题较少）；应作为“下一轮改进的优先攻坚方向”，而非最终定论。

![特征对准确率的影响（pp）](assets/plots/contest8_feature_effects_selected.png)

### 6.7 成本—收益：提升要花多少 tokens？

仅看准确率会忽略真实系统成本。我们基于 run-level 的 `total_tokens` 计算 tokens/question，并输出 `docs/assets/contest8_cost_benefit.csv` 与散点图 `docs/assets/plots/contest8_accuracy_vs_tokens_per_question.png`。

![准确率 vs tokens/题（Contest8 主对比）](assets/plots/contest8_accuracy_vs_tokens_per_question.png)

以 2025 年 DeepSeek-R1 为例：Structured 相比 Multi-turn **+4.0pp**，但 tokens/question 约 **+856（+9.7%）**，折算约 **214 tokens / +1pp**。

同时需要说明：DeepSeek-Chat-V3 的 2025 structured 结果文件缺少 tokens 统计，因此无法在该年做严格的成本对比；跨年份平均上，DeepSeek-Chat-V3 的 structured tokens/question（有记录年份）显著高于 multi-turn，而宏平均准确率仅小幅变化（见第 4.3 节的跨年视角）。

### 6.8 模型间一致性

为了评估“模型间是否在同一题上趋同”，我们定义 **model agreement**：

- 数据范围：Contest8、Multi-turn、仅 primary runs。
- 代表性答案：对同一模型在同一年同一题（同一 `person_id` 与 `idx`）的多次运行答案做**多数票**得到 `maj_answer`（并要求该题该模型至少有 3 个有效 run）。
- 两模型一致：若两模型的 `maj_answer` 相同则记为一致。
- 指标：对每一对模型，计算在两者均有 `maj_answer` 的题目集合上的一致率（见 `docs/assets/contest8_multiturn_model_agreement_majority.csv`）。

下面给出 2025 年的两两一致率热力图（多数票口径）：

![2025 Multi-turn 模型一致率热力图（多数票）](assets/plots/contest8_2025_multiturn_model_agreement_heatmap.png)

**解读建议**：一致率高并不必然代表更“正确”（可能是共同偏差）；但当准确率相近时，一致率更低通常意味着更大的互补空间（可作为后续集成/重排序的线索）。

---

## 7. 研究局限与未来方向

### 7.1 本研究的局限

**1. 数据规模与代表性**
- 每年仅 40 题，部分年份间的差异可能源于统计波动而非模型能力变化
- 数据集包含台湾、马来西亚、新加坡等地的命理竞赛题目，可能存在地区流派偏向

**2. 评测指标单一**
- 当前仅使用准确率作为评测指标，未考虑推理过程的质量
- 四选一的格式无法评估模型在开放式推断中的表现
- 缺乏对"接近正确"答案的部分得分机制

**3. Prompt 工程的有限探索**
- 本研究主要对比了多轮对话和三阶段结构化推理两种方法
- 其他可能的方法（如思维链变体、自我批评机制）未充分探索


---

## 8. 结论

本研究构建了系统性的八字命理选择题评测基准（BaziQA），对五款主流 LLM 进行了全面评测，并提出了三阶段结构化推理协议。

### 8.1 核心发现汇总

| 维度 | 最佳模型 | 表现 | 最差模型 | 表现 |
|------|----------|------|----------|------|
| **综合准确率（Multi-turn，宏平均）** | DeepSeek-Chat-V3 | 36.7% | — | — |
| **年际稳定性（std over years）** | Gemini-2.5-Flash | 2.2% | — | — |
| **硬例题（Multi-turn）** | 全模型共性 | 19/200 题在五模型上均为 0% | — | — |
| **方法效果（2025 DeepSeek-Chat-V3）** | Structured | 42.0% | Multi-turn | 37.0% |

### 8.2 关键结论

**1. LLM 已具备初步命理推断能力**

所有主对比模型均显著优于 25% 随机基线（p 值 $\le 8.9\times 10^{-8}$）。这证明 LLM 确实习得了某些与命理题型相关的可迁移模式，而非纯随机猜测。

**2. 推理/对话模型差异需要更严格的“题型分层”才能定论**

当前缺少**人工金标准**的领域/题型标签；本文使用题干关键词规则生成了可复现但粗粒度的 `domain` 标签（见第 3 节与 `docs/assets/per_question.csv`）。在这一前提下，我们能可靠地观察到：不同模型在不同年份与题目位置上有差异，但“推理模型必然更强”并未在宏平均上直接体现。后续应补充人工标注或更结构化的题型字段后再做强结论。

**3. 三阶段结构化推理有小幅总体收益，但不是“全局必胜”**

在 2025 年 DeepSeek-Chat-V3 上，Structured 相比 Multi-turn 提升 5.0pp，并降低运行间方差；跨年宏平均也呈小幅正向（第 4.3 节）。但逐年/逐域配对结果不稳定，说明其价值更像“针对难题/特定题型的协议化约束”，需要配合更一致的上下文管理与模板校准。

**4. 高难点集中在少数“硬例题”与困难特征上**

在 200 道题中存在一批对多模型均极难的题目（例如五模型均为 0% 的硬例题），并且部分题干特征与更低准确率相关（见第 6.5–6.6 节）。这些证据更适合作为后续协议改进与数据标注的优先方向。

### 8.3 实践建议

| 场景 | 推荐方案 |
|------|----------|
| 通用（Multi-turn，整体最优） | DeepSeek-Chat-V3 |
| 更关注跨年稳定性 | Gemini-2.5-Flash |
| 2025 难题/精确年份题 | 可尝试 DeepSeek-Chat-V3 + Structured Reasoning |
| 需要低波动且输出稳健 | GPT-5.1-Chat |
| 单年份最高（2024） | Gemini-3-Pro（38.5%） |

### 8.4 研究贡献

1. **首个公开的八字命理 LLM 评测基准**：提供 200 道真题、5 年跨度，并给出基于题干启发式规则的领域划分（8 个主要领域，另含“其他”）用于粗粒度分析
2. **三阶段结构化推理协议**：将专业命理师的隐式推理显式化，提供可复现的提示工程方法
3. **多维度深度分析**：从模型、领域、题目位置、统计显著性等多角度揭示 LLM 命理推断的能力与局限

---

## 附录

### A. 复现方法

```bash
# 运行评测（以 DeepSeek-R1 为例；数据文件名沿用 contest8_*.json）
python acc_test/bazi_eval_multiturn.py data/contest8_2025.json --model deepseek-r1

# 运行结构化推理评测
python acc_test/bazi_eval_structured.py data/contest8_2025.json --model deepseek-chat

# 生成汇总数据
python scripts/analyze_results.py

# 查看详细数据
cat docs/assets/experiment_grouped.csv
```

### B. 关键数据文件

| 文件 | 说明 |
|------|------|
| `data/contest8_*.json` | BaziQA 原始题目数据（文件名兼容保留） |
| `result/*/contest8_*_eval_*.json` | 评测结果 |
| `docs/assets/experiment_summary.csv` | 运行级明细 |
| `docs/assets/experiment_grouped.csv` | 模型×年份聚合统计 |
| `docs/assets/per_question.csv` | 逐题明细 |

### C. 三阶段结构化推理协议完整模板

详见 [acc_test/bazi_eval_structured.py](../acc_test/bazi_eval_structured.py) 中的 `SYSTEM_PROMPT_TEMPLATE` 变量。

### D. 定性误差分析：2025 代表性“翻正/翻错”样例（无统计意义）

本附录仅用于帮助读者理解“Structured 可能在哪些题型上改变了决策”，**不用于支持任何统计结论**；统计结论以第 6 章的配对检验与 CI 为准。

样例来源：`docs/assets/contest8_flip_samples_2025_majority.csv`（多数票口径；为可复现起见，该文件为确定性抽取而非随机抽样）。

| 模型 | flip | item_id（person_id#idx） | 领域 | 题干（节选） |
|------|------|--------------------------|------|-------------|
| DeepSeek-Chat-V3 | improved | beijing_male_19700722_P008#1 | 事业 | 命主出社会后的工作？ |
| DeepSeek-Chat-V3 | improved | malaysia_male_19880110_P005#2 | 感情 | 命主在那一年结婚？ |
| DeepSeek-Chat-V3 | regressed | hongkong_female_19870705_P002#0 | 流年运势 | 2022年至现在，命主的健康状况如何？ |
| DeepSeek-Chat-V3 | regressed | taiwan_female_19880215_P007#4 | 其他 | 对命主之描述？ |
| DeepSeek-R1 | improved | singapore_male_19930408_P004#3 | 感情 | 命主感情状况为何？ |
| DeepSeek-R1 | improved | miyazaki_male_19830421_P003#4 | 流年运势 | 2022年，命主发生的重要事件？ |
| DeepSeek-R1 | regressed | guangdong_female_19511114_P001#0 | 六亲 | 此命出生家境如何？ |
| DeepSeek-R1 | regressed | taiwan_female_19880215_P007#2 | 感情 | 命主目前的婚姻状态？ |
